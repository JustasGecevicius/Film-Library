import{O as R,A as M,r as o,u as h}from"./index-2dEkG1oV.js";import{u as f}from"./useQuery-DjxqTrN5.js";import{l as k}from"./api-cQEACmKI.js";import{a as D,b as j}from"./functions-OSBy1Rjh.js";import{f as S,a as b,g as u}from"./firestore-jBxkd18l.js";import{e as L}from"./hooks-CkGFUaI4.js";const O=e=>{const t=[];for(let s=1;s<=10;s++){const c=e.filter(a=>a===s);t.push({x:s,y:c.length})}return t},A=async(e,t,s)=>e?(await R(M(t,`${s==="movie"?"likedMovies":"likedSeries"}`,e))).data():void 0,F=async(e,t,s)=>e?(await R(M(t,`${s==="movie"?"ratedMovies":"ratedSeries"}`,e))).data():void 0,N=(e,t)=>{const[s,c]=o.useState(0),[a,n]=o.useState(0),[i,r]=o.useState(),[d,m]=o.useState(),{data:v}=f(["ratedMovieData",t,e],()=>S(t,u("movie","rated"),e),{enabled:!!e&&!!t});o.useEffect(()=>{if(!v)return;const l=k.round(k.mean(Object.values(v)),1);c(l||0),r(O(Object.values(v)))},[v]);const{data:g}=f(["ratedSeriesData",t,e],()=>S(t,u("series","rated"),e),{enabled:!!e&&!!t});o.useEffect(()=>{if(!g)return;const l=k.round(k.mean(Object.values(g)),1);n(l||0),m(O(Object.values(g)))},[g]);const{data:E}=f(["likedMoviesData",t,e],()=>b(t,u("movie","liked"),e),{enabled:!!e&&!!t}),{data:x}=f(["likedSeriesData",t,e],()=>b(t,u("series","liked"),e),{enabled:!!e&&!!t});return{averageMovieRating:s,averageSeriesRating:a,numberOfLikedMovies:E,numberOfLikedSeries:x,differentMoviesRatings:i,differentSeriesRatings:d}},Q=(e,t)=>{const[s,c]=o.useState(),{db:a}=h(),{config:n}=L(),{data:i}=f(["userLiked",e,a],()=>A(t,a,e),{enabled:!!t&&!!a&&!!e}),{data:r}=f(["filteredLiked",i,n,e],()=>{if(i)return e==="movie"?D(Object.keys(i),n):j(Object.keys(i),n)},{enabled:!!i&&!!n});return o.useEffect(()=>{r&&c(r==null?void 0:r.map(d=>({...d,liked:!0})))},[r]),s},q=(e,t)=>{const[s,c]=o.useState(),{db:a}=h(),{config:n}=L(),{data:i}=f(["userRated",e,a],()=>F(t,a,e),{enabled:!!t&&!!a&&!!e}),{data:r}=f(["rated",e],()=>S(a,u(e,"rated"),t),{enabled:!!t&&!!a}),{data:d}=f(["filteredRated",i,n,e],()=>{if(i)return e==="movie"?D(Object.keys(i),n):j(Object.keys(i),n)},{enabled:!!i&&!!n&&!!r});return o.useEffect(()=>{r&&c((d==null?void 0:d.map(m=>({...m,rating:r[m.id]})))||void 0)},[r,d]),s};export{Q as a,q as b,N as u};
