import{l as f,a as p,g as $}from"./api-BJBHBNH-.js";import{K as l,A as h,s as k,r as i,u as b}from"./index-CASEKhqL.js";import{a as A,u as m}from"./axios-fzcBKtAg.js";import{a as R,u as U}from"./functions-Cg70y5OV.js";import{g as P,u as w}from"./firestore-Dg3MedE5.js";import{f as E,a as L}from"./functions-Xf47q2pl.js";import{e as g}from"./hooks-D22SR9d5.js";const V=(e,t,r,s,o,a)=>{l(h(e,P(a,"liked"),`${r}`),{[t]:o?k():s})},X=(e,t,r,s,o)=>{l(h(e,"likedPeople",`${r}`),{[t]:o?k():s})},x=(e,t)=>{if(t)return e.includes(t.toString())},Y=(e,t,r,s,o)=>{l(h(e,`${P(o,"rated")}`,`${r}`),{[t]:s||k()})},O=(e,t)=>{if(t&&Object.keys(e).includes(t))return e[t]},z=(e,t,r)=>(e.forEach(s=>{s.liked=x(t,s.id.toString()),r&&(s.rating=O(r,s.id.toString()))}),e),N=(e,t)=>{const r=e.images.base_url+e.images.logo_sizes[6],s=[];return t.forEach(o=>{if(o.logo_path){const a=r+o.logo_path,n={...o,logo_path:a};s.push(n)}}),s},Z=e=>{if(f.inRange(e,1e3,999999))return Math.round(e/1e3).toString()+"k";if(f.inRange(e,1e6,999999999))return Math.round(e/1e6).toString()+"m";if(f.inRange(e,1e9,999999999999))return Math.round(e/1e9).toString()+"b"},j=async(e=1,t,r,s)=>await p(r==="movie"?`/movie/${t}/recommendations?api_key=2e1d9e703d345ef35e7a54d9ac882a26&language=en-US&page=${e}`:`/tv/${t}/recommendations?api_key=2e1d9e703d345ef35e7a54d9ac882a26&language=en-US&page=${e}`).then(({data:o})=>s?o:o.results),B=async(e,t)=>await p(t==="movie"?`/movie/${e}/watch/providers?api_key=2e1d9e703d345ef35e7a54d9ac882a26`:`/tv/${e}/watch/providers?api_key=2e1d9e703d345ef35e7a54d9ac882a26`).then(r=>r.data.results),ee=(e,t)=>{if(e)return p(`/person/${e}/${t==="movie"?"movie":"tv"}_credits?api_key=2e1d9e703d345ef35e7a54d9ac882a26&language=en-US`).then(r=>r.data)},D=(e,t)=>p(t==="movie"?`/movie/${e}/credits?api_key=2e1d9e703d345ef35e7a54d9ac882a26&language=en-US`:`/tv/${e}/credits?api_key=2e1d9e703d345ef35e7a54d9ac882a26&language=en-US`).then(r=>r.data),M=(e,t)=>{const r=new URL("http://api.geonames.org/findNearbyPostalCodesJSON?");return e&&t&&(r.searchParams.set("lat",e==null?void 0:e.toString()),r.searchParams.set("lng",t==null?void 0:t.toString()),r.searchParams.set("username","justgece")),A.get(r.toString()).then(s=>s.data)},W=()=>{const[e,t]=i.useState(void 0);e||navigator.geolocation.getCurrentPosition(s=>{const{latitude:o,longitude:a}=s.coords;t({latitude:o,longitude:a})});const{data:r}=m(["location",e],()=>M(e==null?void 0:e.latitude,e==null?void 0:e.longitude),{enabled:!!e,staleTime:18e5});return r==null?void 0:r.postalCodes[0].countryCode},te=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=s.images.base_url+s.images.backdrop_sizes[3]+e.backdrop_path,a=s.images.base_url+s.images.poster_sizes[6]+e.poster_path;r({backdropURL:o,posterURL:a})}},[s,e]),t},se=e=>{const{config:t}=g(),[r,s]=i.useState();return i.useEffect(()=>{if(t&&e){s(t.images.base_url+t.images.profile_sizes[3]+e.profile_path);return}s(void 0)},[t,e]),r},re=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=N(s,e.production_companies);r(o)}},[s,e]),t},oe=(e,t)=>{const[r,s]=i.useState(),{userInfo:o,db:a}=b(),{config:n}=g(),{data:{pages:u}={},fetchNextPage:S}=U(["recommendationData",e,t],({pageParam:c=1})=>j(c,t,e,!0),{getNextPageParam:c=>!Array.isArray(c)&&c.total_pages>c.page?c.page+1:void 0}),{liked:d,rated:v}=w(a,e,o==null?void 0:o.uid);return i.useEffect(()=>{if(!n||!u)return;const c=u.flatMap(({results:y})=>y),_=e==="movie"?E(n,c):L(n,c);if(!d)return s(_);const C=z(_,Object.keys(d),v);s(C)},[n,u,e,d,v]),{results:r,fetchNextPage:S}},I=["movie","series"],ae=(e,t)=>{const[r,s]=i.useState(),{config:o}=g(),{data:a}=m(["movieSeriesCredits",e,t],()=>I.includes(e)?D(t,e):new Promise(n=>n(null)),{enabled:!!e&&!!t});return i.useEffect(()=>{if(!a)return;const n=R(o,a.cast.splice(0,19));s(n)},[a]),r},K=(e,t)=>{if(!t)return;const r=`${t.images.base_url}${t.images.logo_sizes[6]}`,{buy:s,flatrate:o,rent:a,free:n}=e;return f.sortBy({buy:s,flatrate:o,rent:a,free:n},[d=>f.size(d)])[3].map(d=>({...d,logo_path:`${r}${d.logo_path}`}))},ne=(e,t)=>{const[r,s]=i.useState(),{data:o}=m(["config"],$),{data:a}=m(["watchProviders",t,e],()=>B(e,t),{enabled:!!e&&!!t}),n=W();return i.useEffect(()=>{if(a&&n&&o&&a[n]){const u=K(a[n],o);s(u)}},[a,n,o]),r};export{re as a,ae as b,ne as c,X as d,se as e,x as f,O as g,oe as h,z as i,ee as j,V as l,Y as r,Z as s,te as u};
