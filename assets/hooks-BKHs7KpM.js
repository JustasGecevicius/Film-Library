import{l as f,a as p,g as C}from"./api-Da6TUB6i.js";import{K as l,A as h,s as k,r as i,u as y}from"./index-Bbsk2C5Q.js";import{a as b,u as m}from"./axios-DhSPTdmf.js";import{a as Z,u as R}from"./functions-a3rltZny.js";import{g as P,u as U}from"./firestore-DcfGZEYH.js";import{f as w,a as E}from"./functions-Xf47q2pl.js";import{e as g}from"./hooks-0AK4mnPM.js";const H=(e,t,r,s,o,a)=>{l(h(e,P(a,"liked"),`${r}`),{[t]:o?k():s})},V=(e,t,r,s,o)=>{l(h(e,"likedPeople",`${r}`),{[t]:o?k():s})},L=(e,t)=>{if(t)return e.includes(t.toString())},X=(e,t,r,s,o)=>{l(h(e,`${P(o,"rated")}`,`${r}`),{[t]:s||k()})},x=(e,t)=>{if(t&&Object.keys(e).includes(t))return e[t]},O=(e,t,r)=>(e.forEach(s=>{s.liked=L(t,s.id.toString()),r&&(s.rating=x(r,s.id.toString()))}),e),z=(e,t)=>{const r=e.images.base_url+e.images.logo_sizes[6],s=[];return t.forEach(o=>{if(o.logo_path){const a=r+o.logo_path,n={...o,logo_path:a};s.push(n)}}),s},Y=e=>{if(f.inRange(e,1e3,999999))return Math.round(e/1e3).toString()+"k";if(f.inRange(e,1e6,999999999))return Math.round(e/1e6).toString()+"m";if(f.inRange(e,1e9,999999999999))return Math.round(e/1e9).toString()+"b"},N=async(e=1,t,r,s)=>await p(r==="movie"?`/movie/${t}/recommendations?api_key=ZAZA&language=en-US&page=${e}`:`/tv/${t}/recommendations?api_key=ZAZA&language=en-US&page=${e}`).then(({data:o})=>s?o:o.results),j=async(e,t)=>await p(t==="movie"?`/movie/${e}/watch/providers?api_key=ZAZA`:`/tv/${e}/watch/providers?api_key=ZAZA`).then(r=>r.data.results),ee=(e,t)=>{if(e)return p(`/person/${e}/${t==="movie"?"movie":"tv"}_credits?api_key=ZAZA&language=en-US`).then(r=>r.data)},B=(e,t)=>p(t==="movie"?`/movie/${e}/credits?api_key=ZAZA&language=en-US`:`/tv/${e}/credits?api_key=ZAZA&language=en-US`).then(r=>r.data),D=(e,t)=>{const r=new URL("http://api.geonames.org/findNearbyPostalCodesJSON?");return e&&t&&(r.searchParams.set("lat",e==null?void 0:e.toString()),r.searchParams.set("lng",t==null?void 0:t.toString()),r.searchParams.set("username","justgece")),b.get(r.toString()).then(s=>s.data)},M=()=>{const[e,t]=i.useState(void 0);e||navigator.geolocation.getCurrentPosition(s=>{const{latitude:o,longitude:a}=s.coords;t({latitude:o,longitude:a})});const{data:r}=m(["location",e],()=>D(e==null?void 0:e.latitude,e==null?void 0:e.longitude),{enabled:!!e,staleTime:18e5});return r==null?void 0:r.postalCodes[0].countryCode},te=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=s.images.base_url+s.images.backdrop_sizes[3]+e.backdrop_path,a=s.images.base_url+s.images.poster_sizes[6]+e.poster_path;r({backdropURL:o,posterURL:a})}},[s,e]),t},se=e=>{const{config:t}=g(),[r,s]=i.useState();return i.useEffect(()=>{if(t&&e){s(t.images.base_url+t.images.profile_sizes[3]+e.profile_path);return}s(void 0)},[t,e]),r},re=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=z(s,e.production_companies);r(o)}},[s,e]),t},oe=(e,t)=>{const[r,s]=i.useState(),{userInfo:o,db:a}=y(),{config:n}=g(),{data:{pages:d}={},fetchNextPage:S}=R(["recommendationData",e,t],({pageParam:c=1})=>N(c,t,e,!0),{getNextPageParam:c=>!Array.isArray(c)&&c.total_pages>c.page?c.page+1:void 0}),{liked:u,rated:v}=U(a,e,o==null?void 0:o.uid);return i.useEffect(()=>{if(!n||!d)return;const c=d.flatMap(({results:$})=>$),_=e==="movie"?w(n,c):E(n,c);if(!u)return s(_);const A=O(_,Object.keys(u),v);s(A)},[n,d,e,u,v]),{results:r,fetchNextPage:S}},W=["movie","series"],ae=(e,t)=>{const[r,s]=i.useState(),{config:o}=g(),{data:a}=m(["movieSeriesCredits",e,t],()=>W.includes(e)?B(t,e):new Promise(n=>n(null)),{enabled:!!e&&!!t});return i.useEffect(()=>{if(!a)return;const n=Z(o,a.cast.splice(0,19));s(n)},[a]),r},I=(e,t)=>{if(!t)return;const r=`${t.images.base_url}${t.images.logo_sizes[6]}`,{buy:s,flatrate:o,rent:a,free:n}=e;return f.sortBy({buy:s,flatrate:o,rent:a,free:n},[u=>f.size(u)])[3].map(u=>({...u,logo_path:`${r}${u.logo_path}`}))},ne=(e,t)=>{const[r,s]=i.useState(),{data:o}=m(["config"],C),{data:a}=m(["watchProviders",t,e],()=>j(e,t),{enabled:!!e&&!!t}),n=M();return i.useEffect(()=>{if(a&&n&&o&&a[n]){const d=I(a[n],o);s(d)}},[a,n,o]),r};export{re as a,ae as b,ne as c,V as d,se as e,L as f,x as g,oe as h,O as i,ee as j,H as l,X as r,Y as s,te as u};
