import{l as f,j as l,a as b,g as y}from"./api-BC9-h-q6.js";import{K as p,A as h,s as v,r as i,u as A}from"./index-CePdKp91.js";import{u as m}from"./useQuery-D0E1T7FM.js";import{a as R,u as E}from"./functions-DDbdOOuO.js";import{g as C,u as U}from"./firestore-CiYGSoIR.js";import{f as w,a as L}from"./functions-Xf47q2pl.js";import{e as g}from"./hooks-CUaYHlzA.js";const V=(e,t,r,s,o,n)=>{p(h(e,C(n,"liked"),`${r}`),{[t]:o?v():s})},X=(e,t,r,s,o)=>{p(h(e,"likedPeople",`${r}`),{[t]:o?v():s})},j=(e,t)=>{if(t)return e.includes(t.toString())},Y=(e,t,r,s,o)=>{p(h(e,`${C(o,"rated")}`,`${r}`),{[t]:s||v()})},x=(e,t)=>{if(t&&Object.keys(e).includes(t))return e[t]},O=(e,t,r)=>(e.forEach(s=>{s.liked=j(t,s.id.toString()),r&&(s.rating=x(r,s.id.toString()))}),e),z=(e,t)=>{const r=e.images.base_url+e.images.logo_sizes[6],s=[];return t.forEach(o=>{if(o.logo_path){const n=r+o.logo_path,a={...o,logo_path:n};s.push(a)}}),s},Z=e=>{if(f.inRange(e,1e3,999999))return Math.round(e/1e3).toString()+"k";if(f.inRange(e,1e6,999999999))return Math.round(e/1e6).toString()+"m";if(f.inRange(e,1e9,999999999999))return Math.round(e/1e9).toString()+"b"},N=async(e=1,t,r,s)=>await l(`/${r==="movie"?"movie":"tv"}/${t}/recommendations?language=en-US&page=${e}`).then(({data:o})=>s?o:o.results),B=async(e,t)=>await l(`/${t==="movie"?"movie":"tv"}/${e}/watch/providers`).then(r=>r.data.results),ee=(e,t)=>{if(e)return l(`/person/${e}/${t==="movie"?"movie":"tv"}_credits?language=en-US`).then(r=>r.data)},D=(e,t)=>l(`/${t==="movie"?"movie":"tv"}/${e}/credits?language=en-US`).then(r=>r.data),M=(e,t)=>{const r=new URL("https://api.geonames.org/findNearbyPostalCodesJSON?");return e&&t&&(r.searchParams.set("lat",e==null?void 0:e.toString()),r.searchParams.set("lng",t==null?void 0:t.toString()),r.searchParams.set("username","justgece")),b.get(r.toString()).then(s=>s.data)},W=()=>{const[e,t]=i.useState(void 0);e||navigator.geolocation.getCurrentPosition(s=>{const{latitude:o,longitude:n}=s.coords;t({latitude:o,longitude:n})});const{data:r}=m(["location",e],()=>M(e==null?void 0:e.latitude,e==null?void 0:e.longitude),{enabled:!!e,staleTime:18e5});return r==null?void 0:r.postalCodes[0].countryCode},te=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=s.images.base_url+s.images.backdrop_sizes[3]+e.backdrop_path,n=s.images.base_url+s.images.poster_sizes[6]+e.poster_path;r({backdropURL:o,posterURL:n})}},[s,e]),t},se=e=>{const{config:t}=g(),[r,s]=i.useState();return i.useEffect(()=>{if(t&&e){s(t.images.base_url+t.images.profile_sizes[3]+e.profile_path);return}s(void 0)},[t,e]),r},re=e=>{const[t,r]=i.useState(),{config:s}=g();return i.useEffect(()=>{if(e&&s){const o=z(s,e.production_companies);r(o)}},[s,e]),t},oe=(e,t)=>{const[r,s]=i.useState(),{userInfo:o,db:n}=A(),{config:a}=g(),{data:{pages:d}={},fetchNextPage:P}=E(["recommendationData",e,t],({pageParam:c=1})=>N(c,t,e,!0),{getNextPageParam:c=>!Array.isArray(c)&&c.total_pages>c.page?c.page+1:void 0}),{liked:u,rated:S}=U(n,e,o==null?void 0:o.uid);return i.useEffect(()=>{if(!a||!d)return;const c=d.flatMap(({results:$})=>$),k=e==="movie"?w(a,c):L(a,c);if(!u)return s(k);const _=O(k,Object.keys(u),S);s(_)},[a,d,e,u,S]),{results:r,fetchNextPage:P}},I=["movie","series"],ne=(e,t)=>{const[r,s]=i.useState(),{config:o}=g(),{data:n}=m(["movieSeriesCredits",e,t],()=>I.includes(e)?D(t,e):new Promise(a=>a(null)),{enabled:!!e&&!!t});return i.useEffect(()=>{if(!n)return;const a=R(o,n.cast.splice(0,19));s(a)},[n]),r},K=(e,t)=>{if(!t)return;const r=`${t.images.base_url}${t.images.logo_sizes[6]}`,{buy:s,flatrate:o,rent:n,free:a}=e;return f.sortBy({buy:s,flatrate:o,rent:n,free:a},[u=>f.size(u)])[3].map(u=>({...u,logo_path:`${r}${u.logo_path}`}))},ae=(e,t)=>{const[r,s]=i.useState(),{data:o}=m(["config"],y),{data:n}=m(["watchProviders",t,e],()=>B(e,t),{enabled:!!e&&!!t}),a=W();return i.useEffect(()=>{if(n&&a&&o&&n[a]){const d=K(n[a],o);s(d)}},[n,a,o]),r};export{re as a,ne as b,ae as c,X as d,se as e,j as f,x as g,oe as h,O as i,ee as j,V as l,Y as r,Z as s,te as u};
