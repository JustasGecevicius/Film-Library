import{l as d,j as m,b,c as A}from"./api-C7sXjP99.js";import{K as l,A as h,s as P,r as i,u as $}from"./index-SUciGbp2.js";import{u as p}from"./useQuery-BgrSdu3O.js";import{a as R,u as E}from"./functions-ihJZCII3.js";import{g as C,u as U}from"./firestore-Cgg9JWmk.js";import{f as j,a as w}from"./functions-Xf47q2pl.js";import{e as g}from"./hooks-DQnvr9f2.js";const X=(t,e,s,r,o,n)=>{l(h(t,C(n,"liked"),`${s}`),{[e]:o?P():r})},Y=(t,e,s,r,o)=>{l(h(t,"likedPeople",`${s}`),{[e]:o?P():r})},L=(t,e)=>!Array.isArray(t)||t.length===0||typeof e!="string"?!1:t.includes(e),Z=(t,e,s,r,o)=>{l(h(t,`${C(o,"rated")}`,`${s}`),{[e]:r||P()})},x=(t,e)=>{if(!(typeof t!="object"||Array.isArray(t)||!t||typeof e!="string"))if(Object.keys(t).includes(e)){const s=t[e];return typeof s=="number"?s:void 0}else return},O=(t,e,s)=>(t.forEach(r=>{typeof r!="object"||Array.isArray(r)||!(r!=null&&r.id)||(r.liked=L(e,r.id.toString()),r.rating=x(s,r.id.toString()))}),t),z=(t,e)=>{const s=t.images.base_url+t.images.logo_sizes[6],r=[];return e.forEach(o=>{if(o.logo_path){const n=s+o.logo_path,a={...o,logo_path:n};r.push(a)}}),r},I=t=>{if(d.inRange(t,1e3,999999))return Math.round(t/1e3).toString()+"k";if(d.inRange(t,1e6,999999999))return Math.round(t/1e6).toString()+"m";if(d.inRange(t,1e9,999999999999))return Math.round(t/1e9).toString()+"b"},N=async(t=1,e,s,r)=>await m(`/${s==="movie"?"movie":"tv"}/${e}/recommendations?language=en-US&page=${t}`).then(({data:o})=>r?o:o.results),B=async(t,e)=>await m(`/${e==="movie"?"movie":"tv"}/${t}/watch/providers`).then(s=>s.data.results),tt=(t,e)=>{if(t)return m(`/person/${t}/${e==="movie"?"movie":"tv"}_credits?language=en-US`).then(s=>s.data)},D=(t,e)=>m(`/${e==="movie"?"movie":"tv"}/${t}/credits?language=en-US`).then(s=>s.data),W=(t,e)=>{const s=new URL("https://api.geonames.org/findNearbyPostalCodesJSON?");return t&&e&&(s.searchParams.set("lat",t==null?void 0:t.toString()),s.searchParams.set("lng",e==null?void 0:e.toString()),s.searchParams.set("username","justgece")),b.get(s.toString()).then(r=>r.data)},K=()=>{const[t,e]=i.useState(void 0);t||navigator.geolocation.getCurrentPosition(r=>{const{latitude:o,longitude:n}=r.coords;e({latitude:o,longitude:n})});const{data:s}=p(["location",t],()=>W(t==null?void 0:t.latitude,t==null?void 0:t.longitude),{enabled:!!t,staleTime:18e5});return s==null?void 0:s.postalCodes[0].countryCode},et=t=>{const[e,s]=i.useState(),{config:r}=g();return i.useEffect(()=>{if(t&&r){const o=r.images.base_url+r.images.backdrop_sizes[3]+t.backdrop_path,n=r.images.base_url+r.images.poster_sizes[6]+t.poster_path;s({backdropURL:o,posterURL:n})}},[r,t]),e},rt=t=>{const{config:e}=g(),[s,r]=i.useState();return i.useEffect(()=>{if(e&&t){r(e.images.base_url+e.images.profile_sizes[3]+t.profile_path);return}r(void 0)},[e,t]),s},st=t=>{const[e,s]=i.useState(),{config:r}=g();return i.useEffect(()=>{if(t&&r){const o=z(r,t.production_companies);s(o)}},[r,t]),e},ot=(t,e)=>{const[s,r]=i.useState(),{userInfo:o,db:n}=$(),{config:a}=g(),{data:{pages:f}={},fetchNextPage:S}=E(["recommendationData",t,e],({pageParam:c=1})=>N(c,e,t,!0),{getNextPageParam:c=>!Array.isArray(c)&&c.total_pages>c.page?c.page+1:void 0}),{liked:u,rated:v}=U(n,t,o==null?void 0:o.uid);return i.useEffect(()=>{if(!a||!f)return;const c=f.flatMap(({results:_})=>_),y=t==="movie"?j(a,c):w(a,c);if(!u)return r(y);const k=O(y,Object.keys(u),v);r(k)},[a,f,t,u,v]),{results:s,fetchNextPage:S}},Q=["movie","series"],nt=(t,e)=>{const[s,r]=i.useState(),{config:o}=g(),{data:n}=p(["movieSeriesCredits",t,e],()=>Q.includes(t)?D(e,t):new Promise(a=>a(null)),{enabled:!!t&&!!e});return i.useEffect(()=>{if(!n)return;const a=R(o,n.cast.splice(0,19));r(a)},[n]),s},T=(t,e)=>{if(!e)return;const s=`${e.images.base_url}${e.images.logo_sizes[6]}`,{buy:r,flatrate:o,rent:n,free:a}=t;return d.sortBy({buy:r,flatrate:o,rent:n,free:a},[u=>d.size(u)])[3].map(u=>({...u,logo_path:`${s}${u.logo_path}`}))},at=(t,e)=>{const[s,r]=i.useState(),{data:o}=p(["config"],A),{data:n}=p(["watchProviders",e,t],()=>B(t,e),{enabled:!!t&&!!e}),a=K();return i.useEffect(()=>{if(n&&a&&o&&n[a]){const f=T(n[a],o);r(f)}},[n,a,o]),s};export{st as a,nt as b,at as c,Y as d,rt as e,L as f,x as g,ot as h,O as i,tt as j,X as l,Z as r,I as s,et as u};
